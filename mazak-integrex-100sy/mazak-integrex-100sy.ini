[APPLICATIONS]
# uncomment to enable:
#APP = halshow --fformat %.5f switchkins.halshow

[EMC]
VERSION = 1.1
MACHINE = sim-mazak-integrex-100sy (switchkins)
DEBUG = 0

[DISPLAY]
            GEOMETRY = xyzbcw
           OPEN_FILE = ./demos/example_part.ngc
               PYVCP = ./mazak-integrex-100sy.xml
            JOG_AXES = xyzbcw
             DISPLAY = axis
MAX_ANGULAR_VELOCITY =  360
 MAX_LINEAR_VELOCITY = 1500
     POSITION_OFFSET = RELATIVE
   POSITION_FEEDBACK = ACTUAL
   MAX_FEED_OVERRIDE = 2
      PROGRAM_PREFIX = .../../nc_files
       INTRO_GRAPHIC = emc2.gif
          INTRO_TIME = 1
              EDITOR = gedit
         TOOL_EDITOR = tooledit x y z diam front back orien

               TKPKG = Ngcgui 1.0
         NGCGUI_FONT = Helvetica -12 normal

[RS274NGC]
RS274NGC_STARTUP_CODE = G17 G21 G40 G49 G54 G64 P0.001 G80 G90 G92.1 G94 G97 G98
SUBROUTINE_PATH = ./demos:./remap_subs
          REMAP = M428  modalgroup=10  ngc=m428remap
          REMAP = M429  modalgroup=10  ngc=m429remap
          REMAP = M430  modalgroup=10  ngc=m430remap
          REMAP = M431  modalgroup=10  ngc=m431remap
          REMAP = M432  modalgroup=10  ngc=m432remap

          REMAP = M6    modalgroup=6   ngc=m6remap

          REMAP = G67   modalgroup=1   argspec=B    ngc=g67remap
          REMAP = G68   modalgroup=1   argspec=Bxyz ngc=g68remap
          REMAP = G68.1 modalgroup=1   argspec=xyz  ngc=g681remap
          REMAP = M468  modalgroup=10               python=g68_core
          REMAP = G69   modalgroup=1                ngc=g69remap
          REMAP = M469  modalgroup=10               python=g69_core

PARAMETER_FILE = mazak-integrex-100sy.var

[PYTHON]
# where to find the Python code:
# code specific for this configuration
PATH_APPEND = ./python
# import the following Python module
TOPLEVEL = ./python/toplevel.py
# the higher the more verbose tracing of the Python plugin
LOG_LEVEL = 3

[TWP]
DEBUG = 5
# this defines the table rotation
PRIMARY = C
# this defines the spindle rotation (ie the one closest to the tool)
SECONDARY = B
# this defines the prioritized rotary for TWP modes 'G53.n P1' and 'G53.n P2'
# Set to 1 to prioritize the primary joint rotation
# Set to 2 to priotitize the secondary joint rotation
PRIORITY = 2

[KINS]
#NOTE: for backwrds compatibility !!!!!!!!!!!!!!!!!!!
#      default switchkins-type == 0 is mazak-integrex-100sy-kins
#      here    switchkins-type == 0 is identity kins

KINEMATICS = mazak_integrex_100sy_kins
    JOINTS = 6

[HAL]
          HALUI = halui
        HALFILE = LIB:basic_sim.tcl
POSTGUI_HALFILE = mazak-integrex-100sy_postgui.hal

# signal reflecting twp states  (0=undefined, 1=defined, 2=active)
HALCMD = net twp-status       <= motion.analog-out-02
# net for control of motion.switchkins-type
HALCMD = net :kinstype-select <= motion.analog-out-03 => motion.switchkins-type

# vismach mazak-integrex-100sy-gui items
HALCMD = loadusr -W ./vismach/mazak-integrex-100sy-gui.py
HALCMD = net  :axis-x               joint.0.pos-fb             mazak-integrex-100sy-gui.joint_0
HALCMD = net  :axis-y               joint.1.pos-fb             mazak-integrex-100sy-gui.joint_1
HALCMD = net  :axis-z               joint.2.pos-fb             mazak-integrex-100sy-gui.joint_2
HALCMD = net  :tool_spindle_angle   spindle.0.orient-angle     mazak-integrex-100sy-gui.tool_spindle_angle
HALCMD = net  :rotary-b             joint.3.pos-fb             mazak-integrex-100sy-gui.rotary_b
HALCMD = net  :rotary-c             joint.4.pos-fb             mazak-integrex-100sy-gui.rotary_c
HALCMD = net  :axis-w               joint.5.pos-fb             mazak-integrex-100sy-gui.axis_w
HALCMD = net  :tool-diam            halui.tool.diameter        mazak-integrex-100sy-gui.tool_diameter
HALCMD = net  :tool-number          halui.tool.number          mazak-integrex-100sy-gui.tool_number
HALCMD = net  :tool-x-offs          motion.tooloffset.x        mazak-integrex-100sy-gui.tool_x_offset
HALCMD = net  :tool-y-offs          motion.tooloffset.y        mazak-integrex-100sy-gui.tool_y_offset
HALCMD = net  :tool-z-offs          motion.tooloffset.z        mazak-integrex-100sy-gui.tool_length
HALCMD = net  :kinstype-select                                 mazak-integrex-100sy-gui.kinstype_select
HALCMD = net  :pivot-z                                         mazak-integrex-100sy-gui.pivot_z
HALCMD = net  :pivot-x                                         mazak-integrex-100sy-gui.pivot_x
HALCMD = net  :angle-y-yt                                      mazak-integrex-100sy-gui.angle_y_yt
HALCMD = net  :hide-work-piece-1                               mazak-integrex-100sy-gui.hide_work_piece_1
HALCMD = net  :hide-spindle-body                               mazak-integrex-100sy-gui.hide_spindle_body
HALCMD = net  :scale-coords                                    mazak-integrex-100sy-gui.scale_coords
HALCMD = net  :tooltip-rotate-x                                mazak-integrex-100sy-gui.tooltip_rotate_x
HALCMD = net  :tooltip-rotate-y                                mazak-integrex-100sy-gui.tooltip_rotate_y
HALCMD = net  :tooltip-rotate-z                                mazak-integrex-100sy-gui.tooltip_rotate_z

# vismach twp signals
HALCMD = net  twp-ox-world                                  mazak-integrex-100sy-gui.twp_ox_world
HALCMD = net  twp-oy-world                                  mazak-integrex-100sy-gui.twp_oy_world
HALCMD = net  twp-oz-world                                  mazak-integrex-100sy-gui.twp_oz_world
HALCMD = net  twp-ox                                        mazak-integrex-100sy-gui.twp_ox
HALCMD = net  twp-oy                                        mazak-integrex-100sy-gui.twp_oy
HALCMD = net  twp-oz                                        mazak-integrex-100sy-gui.twp_oz
HALCMD = net  twp-zx                                        mazak-integrex-100sy-gui.twp_zx
HALCMD = net  twp-zy                                        mazak-integrex-100sy-gui.twp_zy
HALCMD = net  twp-zz                                        mazak-integrex-100sy-gui.twp_zz
HALCMD = net  twp-xx                                        mazak-integrex-100sy-gui.twp_xx
HALCMD = net  twp-xy                                        mazak-integrex-100sy-gui.twp_xy
HALCMD = net  twp-xz                                        mazak-integrex-100sy-gui.twp_xz
HALCMD = net  twp-status                                    mazak-integrex-100sy-gui.twp_status
HALCMD = net  twp-is-defined                                mazak-integrex-100sy-gui.twp_defined
HALCMD = net  twp-is-active                                 mazak-integrex-100sy-gui.twp_active

# load the required twp-helper component and its hal connections
HALCMD = loadusr -W ./python/twp-helper-comp.py
#twp-status
HALCMD = net twp-status                                     twp-helper-comp.twp-status
HALCMD = net twp-is-defined                                 twp-helper-comp.twp-is-defined
HALCMD = net twp-is-active                                  twp-helper-comp.twp-is-active
# current twp parameters
HALCMD = net twp-ox-world                                   twp-helper-comp.twp-ox-world
HALCMD = net twp-oy-world                                   twp-helper-comp.twp-oy-world
HALCMD = net twp-oz-world                                   twp-helper-comp.twp-oz-world
HALCMD = net twp-ox                                         twp-helper-comp.twp-ox
HALCMD = net twp-oy                                         twp-helper-comp.twp-oy
HALCMD = net twp-oz                                         twp-helper-comp.twp-oz
HALCMD = net twp-zx                                         twp-helper-comp.twp-zx
HALCMD = net twp-zy                                         twp-helper-comp.twp-zy
HALCMD = net twp-zz                                         twp-helper-comp.twp-zz
HALCMD = net twp-xx                                         twp-helper-comp.twp-xx
HALCMD = net twp-xy                                         twp-helper-comp.twp-xy
HALCMD = net twp-xz                                         twp-helper-comp.twp-xz
# used to handle tooltip capture location in the vismach model, unrelated to twp
HALCMD = net :kinstype-select                               twp-helper-comp.kinstype-select
HALCMD = net :tooltip-rotate-x                              twp-helper-comp.tooltip-rotate-x
HALCMD = net :tooltip-rotate-y                              twp-helper-comp.tooltip-rotate-y
HALCMD = net :tooltip-rotate-z                              twp-helper-comp.tooltip-rotate-z
# tool-length compensation in the kinematics
HALCMD = net :tool-x-offs                                   mazak-integrex-100sy-kins.tool-offset-x
HALCMD = net :tool-y-offs                                   mazak-integrex-100sy-kins.tool-offset-y
HALCMD = net :tool-z-offs                                   mazak-integrex-100sy-kins.tool-offset-z
HALCMD = net :tool_spindle_angle                            mazak-integrex-100sy-kins.tool-angle
HALCMD = net :pivot-x                                       mazak-integrex-100sy-kins.pivot-x
HALCMD = net :pivot-z                                       mazak-integrex-100sy-kins.pivot-z
HALCMD = net :angle-y-yt                                    mazak-integrex-100sy-kins.y-yt-angle

[HALUI]
# M428:identity   kins (motion.switchkins-type==0 startupDEFAULT)
# M429:tcp lathe  kins (motion.switchkins-type==1)
# M430:tcp mill   kins (motion.switchkins-type==2)
# M431:twp        kins (motion.switchkins-type==3)
MDI_COMMAND = M428
MDI_COMMAND = M429
MDI_COMMAND = M430
MDI_COMMAND = M431

[TRAJ]
                COORDINATES = xyzbcw
               LINEAR_UNITS = mm
              ANGULAR_UNITS = deg
    DEFAULT_LINEAR_VELOCITY = 100
        MAX_LINEAR_VELOCITY = 120
    MAX_LINEAR_ACCELERATION = 700
DEFAULT_LINEAR_ACCELERATION = 300
                   SPINDLES = 2

[EMCMOT]
      EMCMOT = motmod num_spindles=2
SERVO_PERIOD = 1000000
COMM_TIMEOUT =       1

[TASK]
      TASK = milltask
CYCLE_TIME = 0.010

[EMCIO]
     EMCIO = io
CYCLE_TIME = 0.100
TOOL_TABLE = mazak-integrex-100sy.tbl
TOOL_CHANGE_POSITION = 800 500 100

[AXIS_X]
       MIN_LIMIT = -5000
       MAX_LIMIT =  5000
    MAX_VELOCITY =   200
MAX_ACCELERATION =   700

[AXIS_Y]
       MIN_LIMIT = -5000
       MAX_LIMIT =  5000
    MAX_VELOCITY =   200
MAX_ACCELERATION =   700

[AXIS_Z]
       MIN_LIMIT = -5000
       MAX_LIMIT =  5000
    MAX_VELOCITY =   200
MAX_ACCELERATION =   700


# tool rotating axis
[AXIS_B]
       MIN_LIMIT =  -90
       MAX_LIMIT =   90
    MAX_VELOCITY =   30
MAX_ACCELERATION =  300

# work rotating axis
[AXIS_C]
       MIN_LIMIT = -360
       MAX_LIMIT =  360
    MAX_VELOCITY =   30
MAX_ACCELERATION =  300

[AXIS_W]
       MIN_LIMIT = -5000
       MAX_LIMIT =  5000
    MAX_VELOCITY =   200
MAX_ACCELERATION =   700


[JOINT_0]
              TYPE = LINEAR
              HOME =   350
      MAX_VELOCITY =   200
  MAX_ACCELERATION =   700
         MIN_LIMIT = -5000
         MAX_LIMIT =  5000
   HOME_SEARCH_VEL =     0
     HOME_SEQUENCE =     0


[JOINT_1]
              TYPE = LINEAR
              HOME =     0
      MAX_VELOCITY =   200
  MAX_ACCELERATION =   700
         MIN_LIMIT = -5000
         MAX_LIMIT =  5000
   HOME_SEARCH_VEL =     0
     HOME_SEQUENCE =     0

[JOINT_2]
              TYPE = LINEAR
              HOME =     0
      MAX_VELOCITY =   200
  MAX_ACCELERATION =   700
         MIN_LIMIT = -5000
         MAX_LIMIT =  5000
   HOME_SEARCH_VEL =     0
     HOME_SEQUENCE =     0


# tool spindle
[JOINT_3]
            TYPE = ANGULAR
            HOME =     0
    MAX_VELOCITY =    30
MAX_ACCELERATION =   300
       MIN_LIMIT =   -90
       MAX_LIMIT =    90
     HOME_OFFSET =     0
 HOME_SEARCH_VEL =     0
   HOME_SEQUENCE =     0

# work spindle
[JOINT_4]
            TYPE = ANGULAR
            HOME =      0
    MAX_VELOCITY =     30
MAX_ACCELERATION =    300
       MIN_LIMIT = -36000
       MAX_LIMIT =  36000
 HOME_SEARCH_VEL =      0
   HOME_SEQUENCE =      0

# Axis W
[JOINT_5]
              TYPE = LINEAR
              HOME =   1500
      MAX_VELOCITY =   200
  MAX_ACCELERATION =   700
         MIN_LIMIT = -5000
         MAX_LIMIT =  5000
   HOME_SEARCH_VEL =     0
     HOME_SEQUENCE =     0
